import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.874cb1ca.js";const C=JSON.parse('{"title":"webpack loader 开发示例","description":"","frontmatter":{"layout":"doc"},"headers":[],"relativePath":"webpack/how-to-develop-loader.md","filePath":"webpack/how-to-develop-loader.md"}'),p={name:"webpack/how-to-develop-loader.md"},o=l(`<h1 id="webpack-loader-开发示例" tabindex="-1">webpack loader 开发示例 <a class="header-anchor" href="#webpack-loader-开发示例" aria-label="Permalink to &quot;webpack loader 开发示例&quot;">​</a></h1><h2 id="需求背景介绍" tabindex="-1">需求背景介绍 <a class="header-anchor" href="#需求背景介绍" aria-label="Permalink to &quot;需求背景介绍&quot;">​</a></h2><p>border: 1px 在部分 ios 机型上会展示异常，如半边 border 不展示</p><p>常规解决方案：在元素上设置 2px 的 border 伪元素，并通过 scale(0.5)缩小回 1px</p><p>优化点：代码冗长，且共同点明显，希望简洁代码</p><p>loader 方案：在 less 文件中，扫描 /* half-border */ 注释，如命中则给当前父类添加伪元素</p><p>触发时机：匹配.less 文件 并作用于 less-loader 之前</p><h2 id="具体代码实现" tabindex="-1">具体代码实现 <a class="header-anchor" href="#具体代码实现" aria-label="Permalink to &quot;具体代码实现&quot;">​</a></h2><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">content</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">map</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">meta</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">borderOptions</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RegExp</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">/</span><span style="color:#85E89D;font-weight:bold;">\\/\\*</span><span style="color:#79B8FF;">[\\s\\S]</span><span style="color:#F97583;">*</span><span style="color:#DBEDFF;">half-border</span><span style="color:#79B8FF;">[\\s\\S]</span><span style="color:#F97583;">*</span><span style="color:#85E89D;font-weight:bold;">\\*\\/</span><span style="color:#DBEDFF;">(</span><span style="color:#79B8FF;">[\\s\\S]</span><span style="color:#F97583;">*</span><span style="color:#DBEDFF;">);</span><span style="color:#9ECBFF;">/</span><span style="color:#F97583;">g</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">oldStingMatch</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> content.</span><span style="color:#B392F0;">match</span><span style="color:#E1E4E8;">(borderOptions) </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">oldStingMatch.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, content, map, meta);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">oldString</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> oldStingMatch[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">oldPx</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Number</span><span style="color:#E1E4E8;">(oldString.</span><span style="color:#B392F0;">match</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">(</span><span style="color:#79B8FF;">\\d</span><span style="color:#F97583;">+</span><span style="color:#DBEDFF;">)px</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">)[</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">newContent</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> content.</span><span style="color:#B392F0;">replace</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    oldString,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">\`</span></span>
<span class="line"><span style="color:#9ECBFF;">      position: relative;</span></span>
<span class="line"><span style="color:#9ECBFF;">      padding: \${</span><span style="color:#E1E4E8;">oldPx</span><span style="color:#9ECBFF;">}px;</span></span>
<span class="line"><span style="color:#9ECBFF;">      &amp;::after {</span></span>
<span class="line"><span style="color:#9ECBFF;">        content: &quot;&quot;;</span></span>
<span class="line"><span style="color:#9ECBFF;">        position: absolute;</span></span>
<span class="line"><span style="color:#9ECBFF;">        top: 0;</span></span>
<span class="line"><span style="color:#9ECBFF;">        left: 0;</span></span>
<span class="line"><span style="color:#9ECBFF;">        \${</span><span style="color:#E1E4E8;">oldString</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">replace</span><span style="color:#9ECBFF;">(</span><span style="color:#E1E4E8;">oldPx</span><span style="color:#9ECBFF;">, </span><span style="color:#E1E4E8;">oldPx</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">*</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">)</span><span style="color:#9ECBFF;">};</span></span>
<span class="line"><span style="color:#9ECBFF;">        box-sizing: border-box;</span></span>
<span class="line"><span style="color:#9ECBFF;">        width: 200%;</span></span>
<span class="line"><span style="color:#9ECBFF;">        height: 200%;</span></span>
<span class="line"><span style="color:#9ECBFF;">        transform: scale(0.5);</span></span>
<span class="line"><span style="color:#9ECBFF;">        transform-origin: left top;</span></span>
<span class="line"><span style="color:#9ECBFF;">      }</span></span>
<span class="line"><span style="color:#9ECBFF;">    \`</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">callback</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, newContent, map, meta);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">module</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">exports</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">content</span><span style="color:#24292E;">, </span><span style="color:#E36209;">map</span><span style="color:#24292E;">, </span><span style="color:#E36209;">meta</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">borderOptions</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RegExp</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">/</span><span style="color:#22863A;font-weight:bold;">\\/\\*</span><span style="color:#005CC5;">[\\s\\S]</span><span style="color:#D73A49;">*</span><span style="color:#032F62;">half-border</span><span style="color:#005CC5;">[\\s\\S]</span><span style="color:#D73A49;">*</span><span style="color:#22863A;font-weight:bold;">\\*\\/</span><span style="color:#032F62;">(</span><span style="color:#005CC5;">[\\s\\S]</span><span style="color:#D73A49;">*</span><span style="color:#032F62;">);/</span><span style="color:#D73A49;">g</span></span>
<span class="line"><span style="color:#24292E;">  );</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">oldStingMatch</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> content.</span><span style="color:#6F42C1;">match</span><span style="color:#24292E;">(borderOptions) </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">oldStingMatch.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, content, map, meta);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">oldString</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> oldStingMatch[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">oldPx</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Number</span><span style="color:#24292E;">(oldString.</span><span style="color:#6F42C1;">match</span><span style="color:#24292E;">(</span><span style="color:#032F62;">/(</span><span style="color:#005CC5;">\\d</span><span style="color:#D73A49;">+</span><span style="color:#032F62;">)px/</span><span style="color:#24292E;">)[</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">newContent</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> content.</span><span style="color:#6F42C1;">replace</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    oldString,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">\`</span></span>
<span class="line"><span style="color:#032F62;">      position: relative;</span></span>
<span class="line"><span style="color:#032F62;">      padding: \${</span><span style="color:#24292E;">oldPx</span><span style="color:#032F62;">}px;</span></span>
<span class="line"><span style="color:#032F62;">      &amp;::after {</span></span>
<span class="line"><span style="color:#032F62;">        content: &quot;&quot;;</span></span>
<span class="line"><span style="color:#032F62;">        position: absolute;</span></span>
<span class="line"><span style="color:#032F62;">        top: 0;</span></span>
<span class="line"><span style="color:#032F62;">        left: 0;</span></span>
<span class="line"><span style="color:#032F62;">        \${</span><span style="color:#24292E;">oldString</span><span style="color:#032F62;">.</span><span style="color:#6F42C1;">replace</span><span style="color:#032F62;">(</span><span style="color:#24292E;">oldPx</span><span style="color:#032F62;">, </span><span style="color:#24292E;">oldPx</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">*</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">)</span><span style="color:#032F62;">};</span></span>
<span class="line"><span style="color:#032F62;">        box-sizing: border-box;</span></span>
<span class="line"><span style="color:#032F62;">        width: 200%;</span></span>
<span class="line"><span style="color:#032F62;">        height: 200%;</span></span>
<span class="line"><span style="color:#032F62;">        transform: scale(0.5);</span></span>
<span class="line"><span style="color:#032F62;">        transform-origin: left top;</span></span>
<span class="line"><span style="color:#032F62;">      }</span></span>
<span class="line"><span style="color:#032F62;">    \`</span></span>
<span class="line"><span style="color:#24292E;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">callback</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, newContent, map, meta);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div>`,9),e=[o];function t(c,r,y,E,F,i){return n(),a("div",null,e)}const B=s(p,[["render",t]]);export{C as __pageData,B as default};
