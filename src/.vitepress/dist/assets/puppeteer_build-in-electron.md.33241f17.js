import{_ as s,o as a,c as e,Q as n}from"./chunks/framework.874cb1ca.js";const E=JSON.parse('{"title":"electron 打包 chrome","description":"","frontmatter":{"layout":"doc"},"headers":[],"relativePath":"puppeteer/build-in-electron.md","filePath":"puppeteer/build-in-electron.md"}'),p={name:"puppeteer/build-in-electron.md"},o=n(`<h1 id="electron-打包-chrome" tabindex="-1">electron 打包 chrome <a class="header-anchor" href="#electron-打包-chrome" aria-label="Permalink to &quot;electron 打包 chrome&quot;">​</a></h1><h2 id="问题描述" tabindex="-1">问题描述 <a class="header-anchor" href="#问题描述" aria-label="Permalink to &quot;问题描述&quot;">​</a></h2><p>打包后将.dmg 文件传到没有安装 puppeteer 的电脑后报错。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">// 此段报错通过log到本地文件获得</span></span>
<span class="line"><span style="color:#e1e4e8;">TypeError: Cannot read properties of undefined (reading &#39;newPage&#39;)ither</span></span>
<span class="line"><span style="color:#e1e4e8;"> 1. you did not perform an installation before running the script (e.g. \`npm install\`) or</span></span>
<span class="line"><span style="color:#e1e4e8;"> 2. your cache path is incorrectly configured (which is: /Users/hb19340/.cache/puppeteer).</span></span>
<span class="line"><span style="color:#e1e4e8;">For (2), check out our guide on configuring puppeteer at https://pptr.dev/guides/configuration.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">// 此段报错通过log到本地文件获得</span></span>
<span class="line"><span style="color:#24292e;">TypeError: Cannot read properties of undefined (reading &#39;newPage&#39;)ither</span></span>
<span class="line"><span style="color:#24292e;"> 1. you did not perform an installation before running the script (e.g. \`npm install\`) or</span></span>
<span class="line"><span style="color:#24292e;"> 2. your cache path is incorrectly configured (which is: /Users/hb19340/.cache/puppeteer).</span></span>
<span class="line"><span style="color:#24292e;">For (2), check out our guide on configuring puppeteer at https://pptr.dev/guides/configuration.</span></span></code></pre></div><p>找不到 puppeteer</p><p>在 puppeteer v19 以上 npm i puppeteer，会装在/Users/username/.cache/puppeteer 下，因此 electron 在打包时没有将 chrome 打包进去</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(puppeteer.</span><span style="color:#B392F0;">executablePath</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/Users/luosicheng/.cache/puppeteer/chrome/mac-1069273/chrome-mac/Chromium.app/Contents/MacOS/Chromium&quot;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(puppeteer.</span><span style="color:#6F42C1;">executablePath</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/Users/luosicheng/.cache/puppeteer/chrome/mac-1069273/chrome-mac/Chromium.app/Contents/MacOS/Chromium&quot;</span><span style="color:#24292E;">);</span></span></code></pre></div><h2 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h2><p>对 puppeteer 进行降级，发现 puppeteer v18 将 chrome 装在了 node_modules 中，因此可以顺利打包成功</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// dev</span></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(puppeteer.</span><span style="color:#B392F0;">executablePath</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/Users/luosicheng/Desktop/myCode/auto-publish/node_modules/puppeteer-core/.local-chromium/mac-1045629/chrome-mac/Chromium.app/Contents/MacOS/Chromium&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// build</span></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(puppeteer.</span><span style="color:#B392F0;">executablePath</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/Users/luosicheng/Desktop/myCode/auto-publish/dist/mac/auto-publish.app/Contents/Resources/app.asar/node_modules/puppeteer-core/.local-chromium/mac-1045629/chrome-mac/Chromium.app/Contents/MacOS/Chromium&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 因此只需讲app.asar -&gt; app.asar.unpacked即可</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ePath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> puppeteer</span></span>
<span class="line"><span style="color:#E1E4E8;">  .</span><span style="color:#B392F0;">executablePath</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">  .</span><span style="color:#B392F0;">replace</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;app.asar&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;app.asar.unpacked&quot;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// dev</span></span>
<span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(puppeteer.</span><span style="color:#6F42C1;">executablePath</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/Users/luosicheng/Desktop/myCode/auto-publish/node_modules/puppeteer-core/.local-chromium/mac-1045629/chrome-mac/Chromium.app/Contents/MacOS/Chromium&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// build</span></span>
<span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(puppeteer.</span><span style="color:#6F42C1;">executablePath</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/Users/luosicheng/Desktop/myCode/auto-publish/dist/mac/auto-publish.app/Contents/Resources/app.asar/node_modules/puppeteer-core/.local-chromium/mac-1045629/chrome-mac/Chromium.app/Contents/MacOS/Chromium&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 因此只需讲app.asar -&gt; app.asar.unpacked即可</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ePath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> puppeteer</span></span>
<span class="line"><span style="color:#24292E;">  .</span><span style="color:#6F42C1;">executablePath</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">  .</span><span style="color:#6F42C1;">replace</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;app.asar&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;app.asar.unpacked&quot;</span><span style="color:#24292E;">);</span></span></code></pre></div>`,10),l=[o];function t(c,r,i,u,h,y){return a(),e("div",null,l)}const m=s(p,[["render",t]]);export{E as __pageData,m as default};
